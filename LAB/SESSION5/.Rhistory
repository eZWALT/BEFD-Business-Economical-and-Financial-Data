x = 2
y = 32
x + y
# Dimension 1 vs others
plot.PCA(res_pca, choix="ind", axes=c(1, 2), main="Dim 1 vs Dim 2")
rm(list=ls())
euroleague_23_24 <- read.csv2("euroleague_23_24.csv")
df <- euroleague_23_24[,-1]
min_column = df[,6]
min_column_splited = strsplit(min_column,split=':',fixed=TRUE)
aux <- sapply(min_column_splited, function(x) {
as.numeric(x[1]) * 60 + as.numeric(x[2]) + as.numeric(x[3]) / 60
})
df<- data.frame(Aux = aux, df[,])
# No acabo de entendre si un cop afegit la columna aux s'ha de borra la columna antiga de MIN
games_played <- df[,5]
min2 <- aux/games_played
df <- data.frame(df[,1], Min2 = min2, df[,-1])
str(df)
df$TEAM <- as.factor(df$TEAM)
df$PLAYER<- as.factor(df$PLAYER)
df$POSITION <- as.factor(df$POSITION)
df$GP <- as.numeric(df$GP)
df$GS <- as.numeric(df$GS)
df <- df[,-8] # I delete the column of Min with a String format
str(df)
library(FactoMineR)
categ_vars <- c("TEAM", "PLAYER", "POSITION")
res_pca <- PCA(df, scale.unit = TRUE, graph=FALSE,
quali.sup = which(names(df) %in% categ_vars),
quanti.sup = which(names(df) == "PIR"))
plot(res_pca)
#See eigenvalues great than 1
res_pca$eig
which(res_pca$eig[,1] > 1)
#How many components are needed for 67%?
which(res_pca$eig[,3] > 67)[1]
#How many components are needed for 80%?
which(res_pca$eig[,3] > 80)[1]
#Compute Scree plot
plot(res_pca$eig[,2], type="o", main="Scree Plot: Percentage of Variance by Component", xlab="Number of components", ylab="Percentage of variance", col="blue", pch=16, xaxt="n", yaxt="n")
axis(1, at=1:length(res_pca$eig[,2]), labels=1:length(res_pca$eig[,2]), las=1)
axis(2, las=1)
loadings <- res_pca$var$coord
dim_id <- 4
sort(loadings[, dim_id])
loadings
# Dimension 1 vs others
plot.PCA(res_pca, choix="var", axes=c(1, 2), main="Dim 1 vs Dim 2")
plot.PCA(res_pca, choix="var", axes=c(1, 3), main="Dim 1 vs Dim 3")
plot.PCA(res_pca, choix="var", axes=c(1, 4), main="Dim 1 vs Dim 4")
# Plotting Dim 2 vs others (that haven't been plotted yet)
plot.PCA(res_pca, choix="var", axes=c(2, 3), main="Dim 2 vs Dim 3")
plot.PCA(res_pca, choix="var", axes=c(2, 4), main="Dim 2 vs Dim 4")
# Dim 3 vs Dim 4
plot.PCA(res_pca, choix="var", axes=c(3, 4), main="Dim 3 vs Dim 4")
?plot.PCA
# Dimension 1 vs others
plot.PCA(res_pca, choix="ind", axes=c(1, 2), main="Dim 1 vs Dim 2")
plot.PCA(res_pca, choix="ind", axes=c(1, 3), main="Dim 1 vs Dim 3")
plot.PCA(res_pca, choix="ind", axes=c(1, 4), main="Dim 1 vs Dim 4")
# Plotting Dim 2 vs others (that haven't been plotted yet)
plot.PCA(res_pca, choix="ind", axes=c(2, 3), main="Dim 2 vs Dim 3")
plot.PCA(res_pca, choix="ind", axes=c(2, 4), main="Dim 2 vs Dim 4")
# Finally, Dim 3 vs Dim 4
plot.PCA(res_pca, choix="ind", axes=c(3, 4), main="Dim 3 vs Dim 4")
res_pca$ind
df
df[df$player == "KOSTAS PAPANIKOLAU"]
head(df[df$player == "KOSTAS PAPANIKOLAU"])
df
df[df$player == "KOSTAS ANTETOKOUNMPO"]
df
df[df$player == "KOSTAS ANTETOKOUNMPO", ]
df[player == 'KOSTAS ANTETOKOUNMPO', ]
df$player
df$player
df$PLAYER
df[df$PLAYER == 'KOSTAS ANTETOKOUNMPO', ]
df[df$PLAYER %in% compare_players]
compare_players = c("KOSTAS ANTETOKOUNMPO", "MATHIAS LESSORT")
df[df$PLAYER %in% compare_players]
compare_players = c("KOSTAS ANTETOKOUNMPO", "MATHIAS LESSORT")
df[df$PLAYER %in% compare_players, ]
df
compare_players = c("KOSTAS ANTETOKOUNMPO", "MATHIAS LESSORT")
df[df$PLAYER %in% compare_players, ]
df[df$PLAYER %in% compare_players]
df[df$PLAYER == "MATHIAS LESSORT", ]
df[df$PLAYER == "MATHIAS LESSORT ", ]
df[df$PLAYER %in% compare_players, ]
compare_players = c("KOSTAS ANTETOKOUNMPO", "MATHIAS LESSORT ")
df[df$PLAYER %in% compare_players, ]
filter_players <- function(df, compare_players, compare_vars) {
# Clean up the player names in compare_players to match the format in the DataFrame
compare_players <- trimws(compare_players)  # Trim whitespace
# Filter the DataFrame based on the specified players and variables
filtered_df <- df[df$PLAYER %in% compare_players, compare_vars, drop = FALSE]
return(filtered_df)
}
compare_players = c("KOSTAS ANTETOKOUNMPO", "MATHIAS LESSORT ")
compare_vars = names(df)
filter_players(df, compare_players, compare_vars)
df
#Compare 2 close players in dimension 1 (1st plot)
filter_players(df, c("MATHIAS LESSORT ", "KONSTANTINOS MITOGLOU	", names(df)))
#Compare 2 close players in dimension 1 (1st plot)
filter_players(df, c("MATHIAS LESSORT ", "KONSTANTINOS MITOGLOU	", names(df))
#Compare 2 close players in dimension 1 (1st plot)
filter_players(df, c("MATHIAS LESSORT ", "KONSTANTINOS MITOGLOU	"), names(df))
#Compare 2 opposite players of dimension 1 (1st plot)
filter_players(df, c("KOSTAS ANTETOKOUNMPO", "MATHIAS LESSORT "), names(df))
#Compare 2 opposite players of dimension 1 (1st plot)
filter_players(df, c("KOSTAS ANTETOKOUNMPO", "MATHIAS LESSORT"), names(df))
#Compare 2 opposite players of dimension 1 (1st plot)
filter_players(df, c("KOSTAS ANTETOKOUNMPO", "MATHIAS LESSORT "), names(df))
filter_players <- function(df, compare_players, compare_vars) {
# Clean up the player names in compare_players to match the format in the DataFrame
#compare_players <- trimws(compare_players)  # Trim whitespace
# Filter the DataFrame based on the specified players and variables
filtered_df <- df[df$PLAYER %in% compare_players, compare_vars, drop = FALSE]
return(filtered_df)
}
#Compare 2 opposite players of dimension 1 (1st plot)
filter_players(df, c("KOSTAS ANTETOKOUNMPO", "MATHIAS LESSORT "), names(df))
filter_players
#Compare 2 opposite players of dimension 1 (1st plot)
filter_players(df, c("KOSTAS ANTETOKOUNMPO", "MATHIAS LESSORT "), names(df))
filter_players <- function(df, compare_players, compare_vars) {
# Clean up the player names in compare_players to match the format in the DataFrame
compare_players <- trimws(compare_players)  # Trim whitespace
# Filter the DataFrame based on the specified players and variables
filtered_df <- df[df$PLAYER %in% compare_players, compare_vars, drop = FALSE]
return(filtered_df)
}
#Compare 2 opposite players of dimension 1 (1st plot)
filter_players(df, c("KOSTAS ANTETOKOUNMPO", "MATHIAS LESSORT "), names(df))
filter_players <- function(df, compare_players, compare_vars) {
#compare_players <- trimws(compare_players)  # Trim whitespace
# Filter the DataFrame based on the specified players and variables
filtered_df <- df[df$PLAYER %in% compare_players, compare_vars, drop = FALSE]
return(filtered_df)
}
#Compare 2 opposite players of dimension 1 (1st plot)
filter_players(df, c("KOSTAS ANTETOKOUNMPO", "MATHIAS LESSORT "), names(df))
filter_players <- function(df, compare_players, compare_vars) {
# Clean up the player names in compare_players to match the format in the DataFrame
compare_players <- trimws(compare_players)  # Trim whitespace
# Filter the DataFrame based on the specified players and variables
filtered_df <- df[trimws(df$PLAYER) %in% compare_players, compare_vars, drop = FALSE]
return(filtered_df)
}
#Compare 2 opposite players of dimension 1 (1st plot)
filter_players(df, c("KOSTAS ANTETOKOUNMPO", "MATHIAS LESSORT "), names(df))
#Compare 2 opposite players of dimension 1 (1st plot)
filter_players(df, c("KOSTAS ANTETOKOUNMPO", "MATHIAS LESSORT"), names(df))
filter_players <- function(df, compare_players, compare_vars) {
compare_players <- trimws(compare_players)
#Trim whitespaces to avoid stupid mismatches
filtered_df <- df[trimws(df$PLAYER) %in% compare_players, compare_vars, drop = FALSE]
return(filtered_df)
}
#Compare 2 opposite players of dimension 1 (1st plot)
filter_players(df, c("KOSTAS ANTETOKOUNMPO", "MATHIAS LESSORT"), names(df))
#Compare 2 close players in dimension 1 (1st plot)
filter_players(df, c("MATHIAS LESSORT ", "KONSTANTINOS MITOGLOU	"), names(df))
#Compare 2 opposite players of dimension 1 (1st plot)
filter_players(df, c("KOSTAS ANTETOKOUNMPO", "MATHIAS LESSORT"), names(df))
#Compare 2 close players in dimension 1 (1st plot)
filter_players(df, c("MATHIAS LESSORT ", "KONSTANTINOS MITOGLOU	"), names(df))
#Compare 2 opposite players of dimension 1 (1st plot)
filter_players(df, c("KOSTAS ANTETOKOUNMPO", "MATHIAS LESSORT"), names(df))
#Compare 2 close players in dimension 1 (1st plot)
filter_players(df, c("MATHIAS LESSORT ", "KONSTANTINOS MITOGLOU	"), names(df))
#Compare 2 opposite players of dimension 2 (1st plot)
filter_players(df, c("MATHIAS LESSORT", "FACUNDO CAMPAZZO"), names(df))
#Compare 2 opposite players of dimension 1 (1st plot)
filter_players(df, c("KOSTAS ANTETOKOUNMPO", "MATHIAS LESSORT"), names(df))
#Compare 2 opposite players of dimension 2 (1st plot)
filter_players(df, c("MATHIAS LESSORT", "FACUNDO CAMPAZZO"), names(df))
(df, c("ALEC PETERS", "NIGEL HAYES-DAVIS"), names(df))
#Compare 2 opposite players of dimension 2 (1st plot)
filter_players(df, c("ALEC PETERS", "NIGEL HAYES-DAVIS"), names(df))
df
#Compare 2 close players in dimension 3 (1 vs 3 dim)
filter_players(df, c("ISMAILA DIAGNE", "ALEXANDROS SAMODUROV" ), names(df))
#Compare 2 far players in dimension 3 (1 vs 3 dim)
filter_players(df, c("MATHIAS LESSORT ", "PANAGIOTIS KALAITZAKIS"), names(df))
#Compare 2 close players in dimension 3 (1 vs 3 dim)
filter_players(df, c("ISMAILA DIAGNE", "ALEXANDROS SAMODUROV" ), names(df))
#Compare 2 close players in dimension 4 (2 vs 4 dim)
filter_players(df, c("CARLOS ALOCEN", "MICHALIS LOUNTZIS"), names(df))
#Compare 2 opposite players in dimension 4 (2 vs 4 dim)
filter_players(df, c("FACUNDO CAMPAZZO", "ALEXANDROS SAMODUROV" ), names(df))
df
#Compare 2 close players in dimension 4 (2 vs 4 dim)
filter_players(df, c("CARLOS ALOCEN", "MICHALIS LOUNTZIS"), names(df))
#Compare 2 opposite players in dimension 4 (2 vs 4 dim)
filter_players(df, c("SEHMUS HAZER", "ALEXANDROS SAMODUROV" ), names(df))
#Compare 2 close players in dimension 4 (2 vs 4 dim)
filter_players(df, c("CARLOS ALOCEN", "MICHALIS LOUNTZIS"), names(df))
?cmdscale
library("labdsv")
library("labdsv")
?pco
library(cluster)
## Open iris data set
str(iris)
daisy(iris[1:3,-5])
daisy(iris[1:3,-5],metric = "euclidean")
daisy(iris[1:3,-5],metric = "gower")
daisy(iris[1:3,-5])
daisy(iris[1:3,-5],metric = "euclidean")
daisy(df)
res_pco <- pco(df)
res_pco <- pco(daisy(df))
res_pco
####linear model may be also performed with library(gam)
g0 <- gam(NZ~(tt)+seas)
##1. Quarterly international arrivals (in thousands) to Australia from Japan, New Zealand, UK and the US. 1981Q1 - 2012Q3
library(fpp2)
das
?arrivals
##1. Quarterly international arrivals (in thousands) to Australia from Japan, New Zealand, UK and the US. 1981Q1 - 2012Q3
library(fpp2)
install.packages("forecast")
##1. Quarterly international arrivals (in thousands) to Australia from Japan, New Zealand, UK and the US. 1981Q1 - 2012Q3
library(fpp2)
##1. Quarterly international arrivals (in thousands) to Australia from Japan, New Zealand, UK and the US. 1981Q1 - 2012Q3
library(fpp2)
install.packages("fpp2")
install.packages("fpp2")
##1. Quarterly international arrivals (in thousands) to Australia from Japan, New Zealand, UK and the US. 1981Q1 - 2012Q3
library(fpp2)
?arrivals
autoplot(arrivals)
autoplot(arrivals[,c(1,2)])
Japan<- arrivals[,1]
NZ<- arrivals[,2]
UK<- arrivals[,3]
US<- arrivals[,4]
tt<- (1:length(NZ))
seas <- factor(c(rep(1:4,length(NZ)/4),1:3))
#####1:3 because there are three observations 'out'
mod2 <- lm(NZ~ tt+seas)
#####1:3 because there are three observations 'out'
mod2 <- lm(NZ~ tt+seas)
summary(mod2)
AIC(mod2)
###linear model with no seasonality
mod2a <- lm(NZ~ tt)
summary(mod2a)
#######we now try with a GAM
library(gam)
?s
#Values for df should be greater than 1, with df=1 implying a linear fit. Default is df=4
g1 <- gam(NZ~s(tt)+seas)
summary(g1)
par(mfrow=c(1,2))
plot(g1, se=T)
AIC(g1)
g1a <- gam(NZ~s(tt))
par(mfrow=c(1,2))
plot(g1a, se=T)
summary(g1a)
### Here if the model is linear the result then ---> NO NON-PARAMETRIC ANOVA EFFECTS
g0 <- gam(NZ~(tt)+seas)
summary(g0)
par(mfrow=c(1,2))
plot(g0, se=T)
AIC(g0)
####try another option with loess (lo)
g2<- gam(NZ~lo(tt)+seas)
summary(g2)
par(mfrow=c(1,2))
plot(g2, se=T)
AIC(g2)
### DIFFICULT TO SEE A PATTERN (PERIODICTY AND TRENDS VISIBLE THOUGH) BUT FOR SURE ITS NOT WHITE NOISE
### WE SHOULD HANDLE THE TREND, ITS NOT COMPLETELY STATIONARY YET
#######perform analysis of residuals
tsdisplay(residuals(g1))
### DIFFICULT TO SEE A PATTERN (PERIODICTY AND TRENDS VISIBLE THOUGH) BUT FOR SURE ITS NOT WHITE NOISE
### WE SHOULD HANDLE THE TREND, ITS NOT COMPLETELY STATIONARY YET
#######perform analysis of residuals
tsdisplay(residuals(g1))
aar1<- auto.arima(residuals(g1))
plot(as.numeric(NZ), type="l")
lines(fitted(g1), col=3)
lines(fitted(aar1)+ fitted(g1), col=4)
#######################################################################
####Prophet####
###############
library(prophet)
##2. iPhone sales
##data
iphone=read.csv("iphone.csv", sep=";")
str(iphone)
##some preliminary analysis on the data
iphone$quarter=as.Date(iphone$quarter, format="%d/%m/%Y")
str(iphone)
colnames(iphone)=c("y","ds","cap")
summary(iphone$y) ##to explain why cap is 100
#plot
plot(iphone$y, type="l", x=iphone$ds, ylab="", xlab="Year")
##2. iPhone sales
##data
iphone=read.csv("iphone.csv", sep=";")
##2. iPhone sales
##data
setwd("/home/walterjtv/Escritorio/College/Q11/BEFD-Business-Economical-and-Financial-Data/LAB/SESSION5")
iphone=read.csv("iphone.csv", sep=";")
str(iphone)
##some preliminary analysis on the data
iphone$quarter=as.Date(iphone$quarter, format="%d/%m/%Y")
str(iphone)
colnames(iphone)=c("y","ds","cap")
summary(iphone$y) ##to explain why cap is 100
#plot
plot(iphone$y, type="l", x=iphone$ds, ylab="", xlab="Year")
#model with automatic selection of seasonality (default is "auto")
#in this case just yearly seasonality, if daily and weekly seasonsonality are needed we need to specify
##changepoints not specified, automatically set
m2=prophet(iphone,  growth="logistic")
#n.changepoints default number is 25
summary(m2)
##create a future 'window' for prediction
future2 <- make_future_dataframe(m2, periods = 20, freq="quarter", include_history = T)
tail(future2)
future2$cap=100
forecast2 <- predict(m2, future2)
tail(forecast2[c("ds", "yhat", "yhat_lower", "yhat_upper")])
plot(m2, forecast2)
#Dynamic plot
dyplot.prophet(m2, forecast2)
plot(m2, forecast2)+add_changepoints_to_plot(m2, threshold=0)
#dates corresponding to change points
m2$changepoints
##Prophet with no change points and multiplicative seasonality
m2=prophet(iphone,  growth="logistic", n.changepoints=0, seasonality.mode='multiplicative')
future2 <- make_future_dataframe(m2, periods = 20, freq="quarter", include_history = T)
tail(future2)
future2$cap=100
forecast2 <- predict(m2, future2)
tail(forecast2[c("ds", "yhat", "yhat_lower", "yhat_upper")])
plot(m2, forecast2)
dyplot.prophet(m2, forecast2)
##Prophet with no change points and multiplicative seasonality
m2=prophet(iphone,  growth="logistic", n.changepoints=0, seasonality.mode='multiplicative')
future2 <- make_future_dataframe(m2, periods = 20, freq="quarter", include_history = T)
tail(future2)
future2$cap=100
forecast2 <- predict(m2, future2)
tail(forecast2[c("ds", "yhat", "yhat_lower", "yhat_upper")])
data <- read.csv("movies.csv", stringsAsFactors=TRUE)
str(data)
#erase columns of indicator variables
data<-data[,-c(1,2)]
#transform variable release_date in format "data"
data$release_date <- as.Date(data$release_date, "%d/%m/%Y")
str(data)
# Response variable
summary(data$vote_average)
#boxplot(data$vote_average, col="orange", ylim=c(0,10), main="Movies", ylab="Rating")
#
hist(data$vote_average, col="orange", main="Movies", xlab="Rating")
#
#explanatory variables
summary(data)
summary(data[,c(1,2,5,6)])
par(mfrow=c(2,2))
for(i in c(1,2,5,6)){
hist(data[,i], col="orange", main=paste(colnames(data)[i]), xlab="")
}
#transform quantitative variables in log scale
data$budget <- log(data$budget)
data$popularity <- log(data$popularity)
data$revenue <- log(data$revenue)
summary(data[,c(1,2,5,6)])
par(mfrow=c(2,2))
for(i in c(1,2,5,6)){
hist(data[,i], col="orange", main=paste(colnames(data)[i]), xlab="")
}
#go back to orginal panel
par(mfrow=c(1,1))
#transform release_date in numeric
data$release_date<-as.numeric(data$release_date)
summary(data$release_date)
# Set train and test
set.seed(1)
train = sample (1:nrow(data), 0.7*nrow(data))
data.train=data[train ,]
data.test=data[-train ,]
# make some variables factor
data.train[,c(3,7, 10:24)]= lapply(data.train[,c(3,7, 10:24)],factor)
data.test[,c(3,7, 10:24)]= lapply(data.test[,c(3,7, 10:24)],factor)
str(data.train)
m1 <- lm(vote_average~.-vote_classes, data=data.train)
summary(m1)
summary(m1)
# Stepwise Regression
m2 <- step(m1, direction="both")
summary(m2)
#Prediction
p.lm <- predict(m2, newdata=data.test)
dev.lm <- sum((p.lm-data.test$vote_average)^2)
dev.lm
AIC(m2)
library(gam)
###################
##Stepwise GAM
#Start with a linear model (df=1)
g3 <- gam(vote_average~.-vote_classes, data=data.train)
#Show the linear effects
par(mfrow=c(3,5))
plot(g3, se=T)
sc = gam.scope(data.train[,-8], response=8, arg=c("df=2","df=3","df=4"))
g4<- step.Gam(g3, scope=sc, trace=T)
summary(g4)
AIC(g4)
par(mfrow=c(3,5))
plot(g4, se=T)
